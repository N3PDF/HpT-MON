name: Generate Partonic Mellin results at LO/NLO

on: push

jobs:
  build:

    runs-on: ubuntu-latest
    # container: docker://dvcorg/cml-py3:latest
    strategy:
      max-parallel: 1
      matrix:
        python-version: [3.7]

    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Setup Python & PIP
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install meson & ninja
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install meson ninja

    - name: Install dependencies & HpT-MON
      shell: bash --login {0}
      run: |

        # make scripts executable
        chmod +x install-yaml.sh
        chmod +x install-lhapdf.sh
        chmod +x install-cuba.sh

        echo "$PWD"
        echo "[+] Install YAML:"
        source install-yaml.sh
        echo "[+] Install LHAPDF:"
        echo "$PWD"
        source install-lhapdf.sh
        echo "[+] Install LHHAPDF:"
        ./install-cuba.sh
        echo "[+] Install GSL:"
        sudo apt-get install libgsl-dev
        
        echo "[+] Install HpT-MON:"
        meson setup builddir
        cd builddir
        meson compile

        pkg-config --libs yaml-cpp
        echo "[+] Run LO results:"
        ./higgs ../runcards/higgsfo-lo.yaml
        echo "[+] Run NLO results:"
        ./higgs ../runcards/higgsfo-nlo.yaml

    # - name: Post results as PR comments
    #   env:
    #     repo_token: ${{ secrets.TWINE_USER }}
    #   run: |
    #     echo "### LO" >> report.md
    #     cat higgspt_LO_gg_channel.dat >> report.md
    #     echo "### NLO" >> report.md
    #     cat higgspt_NLO_gg_channel.dat >> report.md
    #     cml-send-comment report.md
